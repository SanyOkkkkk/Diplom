import sqlite3


def create_database(db_path: str):
    ddl = """
    -- -------------------------------------------------
    -- 1.  Companies
    -- -------------------------------------------------
    CREATE TABLE IF NOT EXISTS company (
        company_id   INTEGER PRIMARY KEY AUTOINCREMENT,
        name         TEXT    NOT NULL,
        inn          TEXT    NOT NULL,            -- Russian TIN
        okved        TEXT,                        -- main OKVED
        okved_o      TEXT,                        -- additional OKVED
        measure      TEXT,                        -- units of measure
        tip          TEXT,                        -- form of ownership etc.
        kod_re       TEXT                         -- region code
    );

    CREATE UNIQUE INDEX IF NOT EXISTS idx_company_inn ON company(inn);

    -- -------------------------------------------------
    -- 2.  Regions
    -- -------------------------------------------------
    CREATE TABLE IF NOT EXISTS region (
        kod_re       TEXT PRIMARY KEY,
        name         TEXT NOT NULL,
        federal_district TEXT,
        type         TEXT  -- республика, область, край, город, автономный округ
    );

    -- -------------------------------------------------
    -- 3.  Yearly reports
    -- -------------------------------------------------
    CREATE TABLE IF NOT EXISTS report (
        report_id                   INTEGER PRIMARY KEY AUTOINCREMENT,
        company_id                  INTEGER NOT NULL,
        year                        INTEGER NOT NULL,

        -- Актив
        intangible_assets_eoy       REAL,   -- 11003
        intangible_assets_poy       REAL,   -- 11004
        curr_assets_eoy             REAL,   -- 12003
        curr_assets_poy             REAL,   -- 12004
        balance_assets_eoy          REAL,   -- 16003
        balance_assets_poy          REAL,   -- 16004

        -- Капитал и результаты
        retained_earnings_eoy       REAL,   -- 13703
        retained_earnings_poy       REAL,   -- 13704
        equity_eoy                  REAL,   -- 13003
        equity_poy                  REAL,   -- 13004

        -- Обязательства
        lt_liabilities_eoy          REAL,   -- 14003
        lt_liabilities_poy          REAL,   -- 14004
        st_liabilities_eoy          REAL,   -- 15003
        st_liabilities_poy          REAL,   -- 15004
        balance_liab_eoy            REAL,   -- 17003
        balance_liab_poy            REAL,   -- 17004

        -- Отчет о фин. результатах
        revenue_cur                 REAL,   -- 21103
        revenue_prev                REAL,   -- 21104
        gross_profit_cur            REAL,   -- 21003
        gross_profit_prev           REAL,   -- 21004
        oper_profit_cur             REAL,   -- 22003
        oper_profit_prev            REAL,   -- 22004
        pbt_cur                     REAL,   -- 23003
        pbt_prev                    REAL,   -- 23004
        income_tax_cur              REAL,   -- 24103
        income_tax_prev             REAL,   -- 24104
        net_profit_cur              REAL,   -- 24003
        net_profit_prev             REAL    -- 24004

        -- FK
        , FOREIGN KEY (company_id) REFERENCES company(company_id)
    );

    CREATE UNIQUE INDEX IF NOT EXISTS idx_report_company_year
        ON report(company_id, year);
    """

    conn = sqlite3.connect(db_path)
    cursor = conn.cursor()
    cursor.executescript(ddl)

    # Заполняем таблицу регионов
    fill_regions(cursor)

    conn.commit()
    conn.close()
    print(f"Database created and schema applied to '{db_path}'.")


def fill_regions(cursor):
    """Заполняет таблицу регионов данными"""
    regions_data = [
        # Республики
        ('01', 'Республика Адыгея (Адыгея)', 'Южный федеральный округ', 'республика'),
        ('04', 'Республика Алтай', 'Сибирский федеральный округ', 'республика'),
        ('02', 'Республика Башкортостан', 'Приволжский федеральный округ', 'республика'),
        ('102', 'Республика Башкортостан', 'Приволжский федеральный округ', 'республика'),
        ('702', 'Республика Башкортостан', 'Приволжский федеральный округ', 'республика'),
        ('03', 'Республика Бурятия', 'Дальневосточный федеральный округ', 'республика'),
        ('05', 'Республика Дагестан', 'Северо-Кавказский федеральный округ', 'республика'),
        ('105', 'Республика Дагестан', 'Северо-Кавказский федеральный округ', 'республика'),
        ('80', 'Донецкая Народная Республика', 'Южный федеральный округ', 'республика'),
        ('180', 'Донецкая Народная Республика', 'Южный федеральный округ', 'республика'),
        ('06', 'Республика Ингушетия', 'Северо-Кавказский федеральный округ', 'республика'),
        ('07', 'Кабардино-Балкарская Республика', 'Северо-Кавказский федеральный округ', 'республика'),
        ('08', 'Республика Калмыкия', 'Южный федеральный округ', 'республика'),
        ('09', 'Карачаево-Черкесская Республика', 'Северо-Кавказский федеральный округ', 'республика'),
        ('10', 'Республика Карелия', 'Северо-Западный федеральный округ', 'республика'),
        ('11', 'Республика Коми', 'Северо-Западный федеральный округ', 'республика'),
        ('82', 'Республика Крым', 'Южный федеральный округ', 'республика'),
        ('81', 'Луганская Народная Республика', 'Южный федеральный округ', 'республика'),
        ('181', 'Луганская Народная Республика', 'Южный федеральный округ', 'республика'),
        ('12', 'Республика Марий Эл', 'Приволжский федеральный округ', 'республика'),
        ('13', 'Республика Мордовия', 'Приволжский федеральный округ', 'республика'),
        ('113', 'Республика Мордовия', 'Приволжский федеральный округ', 'республика'),
        ('14', 'Республика Саха (Якутия)', 'Дальневосточный федеральный округ', 'республика'),
        ('15', 'Республика Северная Осетия — Алания', 'Северо-Кавказский федеральный округ', 'республика'),
        ('16', 'Республика Татарстан', 'Приволжский федеральный округ', 'республика'),
        ('116', 'Республика Татарстан', 'Приволжский федеральный округ', 'республика'),
        ('716', 'Республика Татарстан', 'Приволжский федеральный округ', 'республика'),
        ('17', 'Республика Тыва', 'Сибирский федеральный округ', 'республика'),
        ('18', 'Удмуртская Республика', 'Приволжский федеральный округ', 'республика'),
        ('19', 'Республика Хакасия', 'Сибирский федеральный округ', 'республика'),
        ('20', 'Чеченская Республика', 'Северо-Кавказский федеральный округ', 'республика'),
        ('95', 'Чеченская Республика', 'Северо-Кавказский федеральный округ', 'республика'),
        ('21', 'Чувашская Республика', 'Приволжский федеральный округ', 'республика'),
        ('121', 'Чувашская Республика', 'Приволжский федеральный округ', 'республика'),

        # Края
        ('22', 'Алтайский край', 'Сибирский федеральный округ', 'край'),
        ('122', 'Алтайский край', 'Сибирский федеральный округ', 'край'),
        ('75', 'Забайкальский край', 'Дальневосточный федеральный округ', 'край'),
        ('41', 'Камчатский край', 'Дальневосточный федеральный округ', 'край'),
        ('23', 'Краснодарский край', 'Южный федеральный округ', 'край'),
        ('93', 'Краснодарский край', 'Южный федеральный округ', 'край'),
        ('123', 'Краснодарский край', 'Южный федеральный округ', 'край'),
        ('193', 'Краснодарский край', 'Южный федеральный округ', 'край'),
        ('323', 'Краснодарский край', 'Южный федеральный округ', 'край'),
        ('24', 'Красноярский край', 'Сибирский федеральный округ', 'край'),
        ('84', 'Красноярский край', 'Сибирский федеральный округ', 'край'),
        ('88', 'Красноярский край', 'Сибирский федеральный округ', 'край'),
        ('124', 'Красноярский край', 'Сибирский федеральный округ', 'край'),
        ('59', 'Пермский край', 'Приволжский федеральный округ', 'край'),
        ('159', 'Пермский край', 'Приволжский федеральный округ', 'край'),
        ('25', 'Приморский край', 'Дальневосточный федеральный округ', 'край'),
        ('125', 'Приморский край', 'Дальневосточный федеральный округ', 'край'),
        ('26', 'Ставропольский край', 'Северо-Кавказский федеральный округ', 'край'),
        ('126', 'Ставропольский край', 'Северо-Кавказский федеральный округ', 'край'),
        ('27', 'Хабаровский край', 'Дальневосточный федеральный округ', 'край'),

        # Области
        ('28', 'Амурская область', 'Дальневосточный федеральный округ', 'область'),
        ('29', 'Архангельская область', 'Северо-Западный федеральный округ', 'область'),
        ('30', 'Астраханская область', 'Южный федеральный округ', 'область'),
        ('31', 'Белгородская область', 'Центральный федеральный округ', 'область'),
        ('32', 'Брянская область', 'Центральный федеральный округ', 'область'),
        ('33', 'Владимирская область', 'Центральный федеральный округ', 'область'),
        ('34', 'Волгоградская область', 'Южный федеральный округ', 'область'),
        ('134', 'Волгоградская область', 'Южный федеральный округ', 'область'),
        ('35', 'Вологодская область', 'Северо-Западный федеральный округ', 'область'),
        ('36', 'Воронежская область', 'Центральный федеральный округ', 'область'),
        ('136', 'Воронежская область', 'Центральный федеральный округ', 'область'),
        ('85', 'Запорожская область', 'Южный федеральный округ', 'область'),
        ('185', 'Запорожская область', 'Южный федеральный округ', 'область'),
        ('37', 'Ивановская область', 'Центральный федеральный округ', 'область'),
        ('38', 'Иркутская область', 'Сибирский федеральный округ', 'область'),
        ('138', 'Иркутская область', 'Сибирский федеральный округ', 'область'),
        ('39', 'Калининградская область', 'Северо-Западный федеральный округ', 'область'),
        ('91', 'Калининградская область', 'Северо-Западный федеральный округ', 'область'),
        ('40', 'Калужская область', 'Центральный федеральный округ', 'область'),
        ('42', 'Кемеровская область — Кузбасс', 'Сибирский федеральный округ', 'область'),
        ('142', 'Кемеровская область — Кузбасс', 'Сибирский федеральный округ', 'область'),
        ('43', 'Кировская область', 'Приволжский федеральный округ', 'область'),
        ('44', 'Костромская область', 'Центральный федеральный округ', 'область'),
        ('45', 'Курганская область', 'Уральский федеральный округ', 'область'),
        ('46', 'Курская область', 'Центральный федеральный округ', 'область'),
        ('47', 'Ленинградская область', 'Северо-Западный федеральный округ', 'область'),
        ('147', 'Ленинградская область', 'Северо-Западный федеральный округ', 'область'),
        ('48', 'Липецкая область', 'Центральный федеральный округ', 'область'),
        ('49', 'Магаданская область', 'Дальневосточный федеральный округ', 'область'),
        ('50', 'Московская область', 'Центральный федеральный округ', 'область'),
        ('90', 'Московская область', 'Центральный федеральный округ', 'область'),
        ('150', 'Московская область', 'Центральный федеральный округ', 'область'),
        ('190', 'Московская область', 'Центральный федеральный округ', 'область'),
        ('250', 'Московская область', 'Центральный федеральный округ', 'область'),
        ('550', 'Московская область', 'Центральный федеральный округ', 'область'),
        ('750', 'Московская область', 'Центральный федеральный округ', 'область'),
        ('790', 'Московская область', 'Центральный федеральный округ', 'область'),
        ('51', 'Мурманская область', 'Северо-Западный федеральный округ', 'область'),
        ('52', 'Нижегородская область', 'Приволжский федеральный округ', 'область'),
        ('152', 'Нижегородская область', 'Приволжский федеральный округ', 'область'),
        ('252', 'Нижегородская область', 'Приволжский федеральный округ', 'область'),
        ('53', 'Новгородская область', 'Северо-Западный федеральный округ', 'область'),
        ('54', 'Новосибирская область', 'Сибирский федеральный округ', 'область'),
        ('154', 'Новосибирская область', 'Сибирский федеральный округ', 'область'),
        ('55', 'Омская область', 'Сибирский федеральный округ', 'область'),
        ('155', 'Омская область', 'Сибирский федеральный округ', 'область'),
        ('56', 'Оренбургская область', 'Приволжский федеральный округ', 'область'),
        ('156', 'Оренбургская область', 'Приволжский федеральный округ', 'область'),
        ('57', 'Орловская область', 'Центральный федеральный округ', 'область'),
        ('58', 'Пензенская область', 'Приволжский федеральный округ', 'область'),
        ('60', 'Псковская область', 'Северо-Западный федеральный округ', 'область'),
        ('61', 'Ростовская область', 'Южный федеральный округ', 'область'),
        ('161', 'Ростовская область', 'Южный федеральный округ', 'область'),
        ('761', 'Ростовская область', 'Южный федеральный округ', 'область'),
        ('62', 'Рязанская область', 'Центральный федеральный округ', 'область'),
        ('63', 'Самарская область', 'Приволжский федеральный округ', 'область'),
        ('163', 'Самарская область', 'Приволжский федеральный округ', 'область'),
        ('763', 'Самарская область', 'Приволжский федеральный округ', 'область'),
        ('64', 'Саратовская область', 'Приволжский федеральный округ', 'область'),
        ('164', 'Саратовская область', 'Приволжский федеральный округ', 'область'),
        ('65', 'Сахалинская область', 'Дальневосточный федеральный округ', 'область'),
        ('66', 'Свердловская область', 'Уральский федеральный округ', 'область'),
        ('96', 'Свердловская область', 'Уральский федеральный округ', 'область'),
        ('196', 'Свердловская область', 'Уральский федеральный округ', 'область'),
        ('67', 'Смоленская область', 'Центральный федеральный округ', 'область'),
        ('68', 'Тамбовская область', 'Центральный федеральный округ', 'область'),
        ('69', 'Тверская область', 'Центральный федеральный округ', 'область'),
        ('70', 'Томская область', 'Сибирский федеральный округ', 'область'),
        ('71', 'Тульская область', 'Центральный федеральный округ', 'область'),
        ('72', 'Тюменская область', 'Уральский федеральный округ', 'область'),
        ('172', 'Тюменская область', 'Уральский федеральный округ', 'область'),
        ('73', 'Ульяновская область', 'Приволжский федеральный округ', 'область'),
        ('173', 'Ульяновская область', 'Приволжский федеральный округ', 'область'),
        ('74', 'Челябинская область', 'Уральский федеральный округ', 'область'),
        ('174', 'Челябинская область', 'Уральский федеральный округ', 'область'),
        ('774', 'Челябинская область', 'Уральский федеральный округ', 'область'),
        ('76', 'Ярославская область', 'Центральный федеральный округ', 'область'),

        # Города федерального значения
        ('77', 'Москва', 'Центральный федеральный округ', 'город'),
        ('97', 'Москва', 'Центральный федеральный округ', 'город'),
        ('99', 'Москва', 'Центральный федеральный округ', 'город'),
        ('177', 'Москва', 'Центральный федеральный округ', 'город'),
        ('197', 'Москва', 'Центральный федеральный округ', 'город'),
        ('199', 'Москва', 'Центральный федеральный округ', 'город'),
        ('777', 'Москва', 'Центральный федеральный округ', 'город'),
        ('797', 'Москва', 'Центральный федеральный округ', 'город'),
        ('799', 'Москва', 'Центральный федеральный округ', 'город'),
        ('977', 'Москва', 'Центральный федеральный округ', 'город'),
        ('78', 'Санкт-Петербург', 'Северо-Западный федеральный округ', 'город'),
        ('98', 'Санкт-Петербург', 'Северо-Западный федеральный округ', 'город'),
        ('178', 'Санкт-Петербург', 'Северо-Западный федеральный округ', 'город'),
        ('198', 'Санкт-Петербург', 'Северо-Западный федеральный округ', 'город'),
        ('92', 'Севастополь', 'Южный федеральный округ', 'город'),

        # Автономные округа и области
        ('79', 'Еврейская автономная область', 'Дальневосточный федеральный округ', 'автономная область'),
        ('83', 'Ненецкий автономный округ', 'Северо-Западный федеральный округ', 'автономный округ'),
        ('86', 'Ханты-Мансийский автономный округ — Югра', 'Уральский федеральный округ', 'автономный округ'),
        ('186', 'Ханты-Мансийский автономный округ — Югра', 'Уральский федеральный округ', 'автономный округ'),
        ('87', 'Чукотский автономный округ', 'Дальневосточный федеральный округ', 'автономный округ'),
        ('89', 'Ямало-Ненецкий автономный округ', 'Уральский федеральный округ', 'автономный округ'),

        # Специальные территории
        ('94', 'Байконур', 'Специальная территория', 'город'),
        ('188', 'Харьковская область (оккупированная)', 'Специальная территория', 'область'),
    ]

    cursor.executemany("""
        INSERT OR IGNORE INTO region (kod_re, name, federal_district, type)
        VALUES (?, ?, ?, ?)
    """, regions_data)


if __name__ == "__main__":
    db_file = "finance.db"
    create_database(db_file)